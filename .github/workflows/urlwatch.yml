name: Monitor Upstream Releases
on:
  schedule:
    - cron: '10 10 * * *'  # Daily at 10:10
  workflow_dispatch:

permissions:
  actions: read
  contents: write
  issues: write

jobs:
  monitor:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        object:
          - tags
          - branches
        owner:
          - ctt-gob-es
        repo:
          - clienteafirma
          - clienteafirma-external
          - jmulticard
    steps:
      - run: env
      - uses: nilp0inter/urlwatch-action@main
        with:
          cache-name: 'urlwatch-cache-${{ matrix.owner }}-${{ matrix.repo }}-${{ matrix.object }}'
          create-issue: true
          issue-header: 'New entry of type ${{ matrix.object }} in ${{ matrix.owner }}/${{ matrix.repo }}'
          issue-tags: 'upstream,update'
          token: ${{ secrets.GITHUB_TOKEN }}
          urls: |
            url: https://api.github.com/repos/${{ matrix.owner }}/${{ matrix.repo }}/${{ matrix.object }}
            filter:
              - jq: '.[] | .name'
              - sort:
